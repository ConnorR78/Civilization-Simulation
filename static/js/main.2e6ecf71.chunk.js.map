{"version":3,"sources":["components/HelpComponent.js","components/MenuComponent.js","scripts/loadScenario.js","components/LassoComponent.js","components/MapComponent.js","components/ColorBarComponent.js","components/ToolbarComponent.js","plugins/LegendPlugin.js","plugins/RegionInfoPlugin.js","scripts/createScenarioEntry.js","plugins/AltHistEditorLoaderPlugin.js","plugins/ScenarioPlugin.js","appPlugins.js","components/PluginMenuComponent.js","components/TimelineAddButton.js","components/TimelineMarker.js","components/TimelineBarComponent.js","scripts/useWindowSize.js","components/TimelineEventComponent.js","assets/img/MarbleTexture.jpg","assets/img/GoldTexture.png","themes/default.js","App.js","scripts/createRegionDict.js","scripts/createRegionNameDict.js","scripts/saveScenario.js","index.js"],"names":["useStyles","makeStyles","theme","helpContainer","width","helpContent","margin","HelpComponent","props","classes","Grid","className","container","direction","justify","alignItems","href","menuContainer","position","top","left","height","zIndex","display","flexFlow","justifyContent","borderBottomStyle","borderRightStyle","borderColor","palette","border","backgroundImage","main","WebkitBorderImage","borderImage","menuButton","fontSize","padding","MenuComponent","id","Button","size","onClick","window","location","reload","save","onDrop","acceptedFiles","file","onload","text","then","obj","JSON","parse","loadScenario","loadSave","getRootProps","getInputProps","openHelp","LassoComponent","eventHandler","event","indices","layers","forEach","layer","feature","properties","regionID","push","updateLassoSelecting","assignRegions","map","useMap","lasso","L","setOptions","intersect","enable","React","useEffect","addEventListener","disable","removeEventListener","mapProviders","name","attr","src","MapComponent","state","baseMap","geojsonRef","createRef","onEachFeature","bind","style","resetAllRegionStyle","clickRegion","highlightRegion","resetHighlightRegion","lassoSelecting","processRegionHoveredOn","processRegionHoveredOut","index","color","this","regionDict","themeDict","polyFillColorDefault","polyStrokeColor","weight","polyStrokeWeight","fillColor","fillOpacity","polyFillOpacityColored","polyFillOpacityDefault","polyFillOpacityHovered","setStyle","hightlightStyle","Object","values","current","_layers","MapContainer","center","zoom","scrollWheelZoom","preferCanvas","zoomSnap","wheelPxPerZoomLevel","doubleClickZoom","zoomControl","attributionControl","worldCopyJump","mapContainer","LayersControl","entry","BaseLayer","checked","TileLayer","attribution","url","Overlay","GeoJSON","data","ref","AttributionControl","Component","withStyles","filter","ColorBarComponent","colorBarContainer","onChange","setState","hex","backgroundColor","background","paper","marginTop","borderStyle","toolbarContainer","right","marginRight","borderLeftStyle","toolbarButton","ToolbarComponent","lassoButtonText","lassoButtonColor","eraserButtonText","erasing","eraserButtonColor","updateErasing","legendContainer","legendEntry","legendEntryColor","legendEntryLabel","legendGrid","LegendEntry","setDefaultColorBarColor","InputBase","value","label","LegendPluginDict","component","entries","keys","app","pluginData","activeEntry","item","e","currentLegendData","cloneDeep","target","updatePluginData","wrap","initState","scenarioData","i","retval","length","functions","onAssignRegions","removedColors","addedColor","onAddEntry","newLegendEntry","splice","onDeleteEntry","onUpdateActiveEntry","onUpdateEventDate","onUpdateEvent","onLoadSave","onProcessRegionHoveredOn","onProcessRegionHoveredOut","regionInfoContainer","paddingLeft","regionInfoColor","marginLeft","primary","regionInfoLabel","paddingTop","paddingBottom","RegionInfoPluginDict","other","Typography","variant","newRegionInfoData","createScenarioEntry","date","csscolors","altHistEditorLoaderContainer","loaderDropzone","textAlign","default","loader","currentSaveVersion","version","detectSaveVersion","processSave","one_zero_to_one_one","one_one_to_one_two","customMap","customMapGeojson","order","entryDict","AltHistEditorLoaderPluginDict","mapType","convertedObj","colorData","regionDictDefault","mapData","colorStringDict","colorEntry","plugins","scenarioDataDefault","legendData","console","log","scenarios","scen356BC","scen1206","scen1444","scen1936","scenarioContainer","scenarioSelect","RegionInfoPlugin","LegendPlugin","useState","selectedScenario","setSelectedScenario","Select","key","MenuItem","AltHistEditorLoaderPlugin","pluginMenuContainer","minWidth","minHeight","transform","borderTopStyle","accordionContainer","paddingRight","accordionSummary","accordionDetails","PluginMenuComponent","accordionItems","Plugin","Accordion","defaultExpanded","square","AccordionSummary","expandIcon","IconButtonProps","AccordionDetails","addIconButtonContainer","addIconButton","secondary","TimelineAddButton","timelineMarkerSpacing","IconButton","addEntry","timelineMarker","entryButton","markerLabel","textOverflow","overflow","whiteSpace","TimelineMarker","icon","selected","timelineMarkerLabelWidth","updateActiveEntry","timelineBarContainer","bottom","timelineLine","timelineBarContentContainer","timelineBarMarkerContainer","TimelineBarComponent","markers","setSize","useLayoutEffect","updateSize","innerWidth","innerHeight","useWindowSize","lineLength","Math","max","eventContainer","eventBar","eventContent","flexGrow","resize","eventButton","dateInput","TimelineEventComponent","TextField","updateEventDate","clearEntry","deleteEntry","disabled","oneEntryLeft","updateEvent","multiline","material","type","light","dark","GoldTexture","MarbleTexture","ReactGA","initialize","pageview","pathname","search","geoJson","features","region","createRegionDict","mapAdmin","regionNameDict","createRegionNameDict","createMuiTheme","App","helpOn","colorBarRef","mapRef","getColor","closeHelp","currentData","newState","callback","currentColorData","newRegionDict","newColorEntry","newIndex","previousColor","blob","Blob","stringify","saveAs","saveScenario","saveData","ThemeProvider","Backdrop","backdrop","open","defaultColorBarColor","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.2e6ecf71.chunk.js","sourcesContent":["import { makeStyles } from '@material-ui/core/styles';\r\nimport Grid from \"@material-ui/core/Grid\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    helpContainer: {\r\n        width: \"70%\"\r\n    },\r\n    helpContent: {\r\n        margin: 5,\r\n    }\r\n}));\r\n\r\nexport default function HelpComponent(props) {\r\n    const classes = useStyles();\r\n    return (\r\n        <Grid className = { classes.helpContainer } container direction = \"column\" justify = \"center\" alignItems = \"flex-start\">\r\n            <h1 className={classes.helpContent}>Welcome to Making History Sandbox!</h1>\r\n            <h3 className={classes.helpContent}>Click anywhere to return to app</h3>\r\n            <p className={classes.helpContent}>This is an app aiming to make alternate history timeline creations easier. Features include a map with named regions that can be easily labelled, interactive timeline for adding/removing timepoints, pre-made scenarios and more.</p>\r\n            <h2 className={classes.helpContent}>Coloring and Labelling</h2>\r\n            <p className={classes.helpContent}>Use the top panel to pick a color, then simply click the region you wish to color. Then, use Legend panel on the right to modify the label name for regions of the color.</p>\r\n            <p className={classes.helpContent}>For mass labelling, click lasso under the color panel to activate lasso mode.</p>\r\n            <p className={classes.helpContent}>To erase, click erase under the color panel, then either click on region to unlabel or use lasso to mass unlabel.</p>\r\n            <h2 className={classes.helpContent}>Adding and deleting entries</h2>\r\n            <p className={classes.helpContent}>Use the Delete button on the bottom right to delete the current time point</p>\r\n            <p className={classes.helpContent}>Use the small + on the timeline to add time points in the location. The added entry will inherit the previous entry</p>\r\n            <h2 className={classes.helpContent}>Switching background</h2>\r\n            <p className={classes.helpContent}>Use the top right layers icon to choose the background map and whether regions should be displayed</p>\r\n            <h2 className={classes.helpContent}>Alternate History Editor users</h2>\r\n            <p className={classes.helpContent}>Use the Alt Hist Editor Loader panel at the end of the right panel (scroll down if it isn't visible)</p>\r\n            <h2 className={classes.helpContent}>For those that want to see code</h2>\r\n            <a className={classes.helpContent} href=\"https://github.com/Yulin-W/making-history-sandbox\">Github repository</a>\r\n        </Grid>\r\n    );\r\n}","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Button from '@material-ui/core/Button';\r\nimport loadScenario from '../scripts/loadScenario.js';\r\nimport Dropzone from 'react-dropzone';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    menuContainer: {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        left: 0,\r\n        height: 25,\r\n        width: 255,\r\n        zIndex: 1,\r\n        display: \"flex\",\r\n        flexFlow: \"row\",\r\n        justifyContent: \"flex-start\",\r\n        borderBottomStyle: \"ridge\",\r\n        borderRightStyle: \"ridge\",\r\n        borderColor: theme.palette.border,\r\n        backgroundImage: theme.palette.backgroundImage.main,\r\n        WebkitBorderImage: theme.palette.borderImage\r\n    },\r\n    menuButton: {\r\n        fontSize: 12,\r\n        margin: 0,\r\n        padding: 0,\r\n        height: \"100%\",\r\n    }\r\n}));\r\n\r\nexport default function MenuComponent(props) {\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.menuContainer} id=\"menu\">\r\n            <Button size=\"small\" className={classes.menuButton} onClick={() => window.location.reload()}>New</Button>\r\n            <Button size=\"small\" className={classes.menuButton} onClick={props.save}>Save</Button>\r\n            <Dropzone\r\n                onDrop={acceptedFiles => {\r\n                    loadScenario(acceptedFiles[0], props.loadSave);\r\n                }}\r\n            >\r\n                {/*acceptedFiles[0] as we only care about a single file TODO: make some restriction to filetype (.json) to upload and number of files to upload (1 only)*/}\r\n                {/*TODO: Here we used a drop zone, this might be an overkill to be honest as I only need a load button, so if performance drops too much or too much bandwidth taken, try to simplify this*/}\r\n                {({ getRootProps, getInputProps }) => (\r\n                    <div {...getRootProps()}>\r\n                        <input {...getInputProps()} />\r\n                        <Button size=\"small\" className={classes.menuButton}>Load</Button>\r\n                        {/*This is a dummy button for visuals only, the uploading functionality is contained in the Dropzone and the input element*/}\r\n                    </div>\r\n                )}\r\n                </Dropzone>\r\n            <Button size=\"small\" className={classes.menuButton} onClick={props.openHelp}>Help</Button>\r\n        </div>\r\n    );\r\n}","// Expects a single file object, one that is compatible with JSON.stringify after processing\r\n// Returns the JSON object\r\nexport default function loadScenario(file, onload=null) {\r\n    file.text().then(text => {\r\n        const obj = JSON.parse(text);\r\n        if (onload) {\r\n            onload(obj);\r\n        }\r\n    });\r\n}","import React from \"react\";\r\nimport L from \"leaflet\";\r\nimport { useMap } from \"react-leaflet\";\r\nimport \"leaflet-lasso\";\r\n\r\nexport default function LassoComponent(props) {\r\n    // Event handler for when lasso selection is complete\r\n    const eventHandler = event => {\r\n        let indices = [];\r\n        if (event) { // Series of if statements to only record in indices the valid selected regions TODO: this seems a bit dodgy, problem is this is like one of those silently neglect mistakes types of code\r\n            if (event.layers) {\r\n                event.layers.forEach(layer => {\r\n                    if (layer) {\r\n                        if (layer.feature) {\r\n                            if (layer.feature.properties) {\r\n                                if (layer.feature.properties.regionID) {\r\n                                    indices.push(layer.feature.properties.regionID);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                });       \r\n            }\r\n        }\r\n        props.updateLassoSelecting(false, () => {props.assignRegions(indices);})\r\n    };\r\n\r\n    // Setup lasso\r\n    const map = useMap();\r\n    const lasso = L.lasso(map);\r\n    lasso.setOptions({ intersect: true });\r\n    lasso.enable();\r\n\r\n    React.useEffect(() => {\r\n        // Execute region coloring upon lasso selection completion\r\n        map.addEventListener('lasso.finished', eventHandler);\r\n\r\n        return (() => { // What to do on unmounting the LassoComponent\r\n            lasso.disable(); // FIXME: bug: disabling via clicking cancel button, i.e. in the case of disabling via using the cancel button, appears to lead to the drawing of selection persisting, though that selection has no coloring effect\r\n            map.removeEventListener('lasso.finished', eventHandler); // Remove event handler to avoid creating multiple handlers\r\n        });\r\n    }, [map, lasso]);\r\n\r\n    return null;\r\n}\r\n","// Import React\r\nimport React from \"react\";\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// Import leaflet\r\nimport { MapContainer, GeoJSON, TileLayer, AttributionControl, LayersControl } from 'react-leaflet';\r\nimport \"leaflet/dist/leaflet.css\";\r\n\r\n// Import relevant custom components for plugins\r\nimport LassoComponent from \"./LassoComponent.js\";\r\n\r\nconst useStyles = theme => ({\r\n    mapContainer: {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        left: 0,\r\n        width: \"100vw\",\r\n        height: \"calc(100vh - 45px)\", // the -50px is to ensure that the map's bottom meets the timeline bar, hence if timeline bar height is adjusted, adjust map height here accordingly\r\n        zIndex: 0,\r\n        filter: \"brightness(1) contrast(100%)\",\r\n    },\r\n});\r\n\r\n// Add leaflet providers here\r\nconst mapProviders = [\r\n    {\r\n        name: \"Esri.WorldImagery\",\r\n        attr: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',\r\n        src: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'\r\n    },\r\n    {\r\n        name: \"OpenTopoMap\",\r\n        attr: 'Map data: &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, <a href=\"http://viewfinderpanoramas.org\">SRTM</a> | Map style: &copy; <a href=\"https://opentopomap.org\">OpenTopoMap</a> (<a href=\"https://creativecommons.org/licenses/by-sa/3.0/\">CC-BY-SA</a>)',\r\n        src: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png'\r\n    },\r\n    {\r\n        name: \"OpenStreetMap.Mapnik\",\r\n        attr: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n        src: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'\r\n    },\r\n    {\r\n        name: \"Stamen.TerrainBackground\",\r\n        attr: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n        src: 'https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}{r}.png'\r\n    },\r\n    {\r\n        name: \"Stamen.Watercolor\",\r\n        attr: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n        src: 'https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png'\r\n    },\r\n]\r\nclass MapComponent extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            baseMap: props.baseMap,\r\n        }\r\n        this.geojsonRef = React.createRef(null);\r\n        // Binding methods\r\n        this.onEachFeature = this.onEachFeature.bind(this);\r\n        this.style = this.style.bind(this);\r\n        this.resetAllRegionStyle = this.resetAllRegionStyle.bind(this);\r\n        this.clickRegion = this.clickRegion.bind(this);\r\n        this.highlightRegion = this.highlightRegion.bind(this);\r\n        this.resetHighlightRegion = this.resetHighlightRegion.bind(this);\r\n    }\r\n\r\n    onEachFeature(feature, layer) {\r\n        layer.addEventListener(\"click\", () => {\r\n            this.clickRegion(feature, layer);\r\n        });\r\n        layer.addEventListener(\"mouseover\", () => {\r\n            if (!this.props.lassoSelecting) {\r\n                // Ensures lasso selection is not interfered by mouse events\r\n                this.highlightRegion(feature, layer);\r\n                this.props.processRegionHoveredOn(layer);\r\n            }\r\n        });\r\n        layer.addEventListener(\"mouseout\", () => {\r\n            if (!this.props.lassoSelecting) {\r\n                // Ensures lasso selection is not interfered by mouse events\r\n                this.resetHighlightRegion(feature, layer);\r\n                this.props.processRegionHoveredOut(layer);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Returns hex color for the region of the specified index\r\n    getRegionColorByIndex(index) {\r\n        let color = this.props.regionDict[index].color;\r\n        // Return color hex if there is one, else if record shows null color, use the default fill color as specified in themeDict\r\n        return color ? color : this.props.themeDict.polyFillColorDefault;\r\n    }\r\n\r\n    style(feature, layer) {\r\n        const color = this.props.regionDict[feature.properties.regionID].color;\r\n        return {\r\n            color: this.props.themeDict.polyStrokeColor,\r\n            weight: this.props.themeDict.polyStrokeWeight,\r\n            fillColor: color ? color : this.props.themeDict.polyFillColorDefault,\r\n            fillOpacity: color ? this.props.themeDict.polyFillOpacityColored : this.props.themeDict.polyFillOpacityDefault,\r\n        };\r\n    }\r\n\r\n\r\n    hightlightStyle(feature, layer) {\r\n        return {\r\n            fillOpacity: this.props.themeDict.polyFillOpacityHovered\r\n        };\r\n    }\r\n\r\n    highlightRegion(feature, layer) {\r\n        layer.setStyle(this.hightlightStyle(feature, layer));\r\n    }\r\n\r\n    resetHighlightRegion(feature, layer) {\r\n        layer.setStyle(this.style(feature, layer));\r\n    }\r\n\r\n    clickRegion(feature, layer) {\r\n        this.props.assignRegions([feature.properties.regionID]);\r\n        layer.setStyle(this.style(feature, layer)); // TODO: such setting would not highlight the region though, which might be a problem\r\n    }\r\n\r\n    // Resets styles of all regions to match those of the regionDict data\r\n    resetAllRegionStyle() {\r\n        Object.values(this.geojsonRef.current._layers).forEach(layer => {\r\n            layer.setStyle(this.style(layer.feature, layer));\r\n        });\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n\r\n        return (\r\n            <MapContainer\r\n                center={[30, 0]}\r\n                zoom={3}\r\n                scrollWheelZoom\r\n                preferCanvas\r\n                zoomSnap={0}\r\n                wheelPxPerZoomLevel={120}\r\n                doubleClickZoom={false}\r\n                zoomControl={false}\r\n                attributionControl={false}\r\n                worldCopyJump\r\n                id=\"map\"\r\n                className={classes.mapContainer}\r\n            >\r\n                <LayersControl position=\"topright\">\r\n                    {mapProviders.map((entry, index) => <LayersControl.BaseLayer key={entry.name} checked={index===0} name={entry.name}>\r\n                        <TileLayer\r\n                            attribution={entry.attr}\r\n                            url={entry.src}\r\n                        ></TileLayer>\r\n                    </LayersControl.BaseLayer>)}\r\n                    <LayersControl.Overlay checked name=\"Regions\">\r\n                        <GeoJSON\r\n                            data={this.state.baseMap}\r\n                            style={this.style}\r\n                            onEachFeature={this.onEachFeature}\r\n                            ref={this.geojsonRef}\r\n                        ></GeoJSON>\r\n                    </LayersControl.Overlay>\r\n                </LayersControl>\r\n                <AttributionControl position=\"bottomright\" />\r\n                {this.props.lassoSelecting && <LassoComponent updateLassoSelecting={this.props.updateLassoSelecting} assignRegions={this.props.assignRegions} />}\r\n            </MapContainer>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(useStyles)(MapComponent);","// Import React\r\nimport React from \"react\";\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// Import color picker\r\nimport { SliderPicker } from 'react-color';\r\n\r\nconst useStyles = theme => ({\r\n    colorBarContainer: {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        left: \"35%\",\r\n        width: \"30%\",\r\n        height: 50,\r\n        zIndex: 1,\r\n        backgroundColor: theme.palette.background.paper,\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        flexFlow: \"column\",\r\n        alignItems: \"stretch\",\r\n        marginTop: 5,\r\n        padding: 5,\r\n        borderStyle: \"ridge\",\r\n        borderColor: theme.palette.border,\r\n        WebkitBorderImage: theme.palette.borderImage\r\n    },\r\n});\r\n\r\nclass ColorBarComponent extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            color: \"#bf4340\", // Default color, it is the color when slider in first row of color bar is set to leftmost position, and the centre one of the 5 colors in the second row of the color bar is chosen\r\n        }\r\n    }\r\n\r\n    render() { //FIXME: add some color tests to ensure that selected color is notified if coincides with a color already on the page\r\n        const { classes } = this.props;\r\n        return (\r\n            <div className={classes.colorBarContainer} id=\"colorbar\">\r\n                <SliderPicker color={this.state.color} onChange={(color, event) => this.setState({color: color.hex})}/>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(useStyles)(ColorBarComponent);","// Import React\r\nimport React from \"react\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Button from \"@material-ui/core/Button\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    toolbarContainer: {\r\n        position: \"absolute\",\r\n        top: 70,\r\n        right: \"50%\",\r\n        marginRight: -148/2,\r\n        height: 30,\r\n        width: 130,\r\n        zIndex: 1,\r\n        display: \"flex\",\r\n        flexFlow: \"row\",\r\n        justifyContent: \"flex-end\",\r\n        borderBottomStyle: \"ridge\",\r\n        borderLeftStyle: \"ridge\",\r\n        borderRightStyle: \"ridge\",\r\n        borderColor: theme.palette.border,\r\n        backgroundImage: theme.palette.backgroundImage.main,\r\n        WebkitBorderImage: theme.palette.borderImage\r\n    },\r\n    toolbarButton: {\r\n        fontSize: 12,\r\n        margin: 0,\r\n        padding: 0,\r\n        height:\"100%\",\r\n    }\r\n}));\r\n\r\nexport default function ToolbarComponent(props) {\r\n        const classes = useStyles();\r\n        const lassoButtonText = props.lassoSelecting ? \"Cancel\" : \"Lasso\"; // TODO: using switches might be better in these situations\r\n        const lassoButtonColor = props.lassoSelecting ? \"secondary\" : \"default\";\r\n        const eraserButtonText = props.erasing ? \"Cancel\" : \"Erase\";\r\n        const eraserButtonColor = props.erasing ? \"secondary\" : \"default\";\r\n        return (\r\n            <div className={classes.toolbarContainer} id=\"toolbar\">\r\n                <Button color={eraserButtonColor} className={classes.toolbarButton} onClick={() => {props.updateErasing(!props.erasing);}}>{eraserButtonText}</Button>\r\n                <Button color={lassoButtonColor} className={classes.toolbarButton} onClick={() => {props.updateLassoSelecting(!props.lassoSelecting);}}>{lassoButtonText}</Button>\r\n            </div>\r\n        );\r\n    }","import { makeStyles } from '@material-ui/core/styles';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Scrollbars from 'react-custom-scrollbars';\r\nimport cloneDeep from \"clone-deep\";\r\nimport InputBase from '@material-ui/core/InputBase';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    legendContainer: {\r\n        height: 200,\r\n        width: \"100%\",\r\n    },\r\n    legendEntry: {\r\n        display: \"flex\",\r\n        flexFlow: \"row\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"flex-start\",\r\n    },\r\n    legendEntryColor: {\r\n        width: 12,\r\n        height: 12,\r\n        margin: 5,\r\n    },\r\n    legendEntryLabel: {\r\n        fontSize: 11,\r\n    },\r\n    legendGrid: {\r\n        height: 200,\r\n    }\r\n}));\r\n\r\nfunction LegendEntry(props) {\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.legendEntry}>\r\n            <div\r\n                style={{ backgroundColor: props.color }}\r\n                className={classes.legendEntryColor}\r\n                onClick={() => {\r\n                    props.setDefaultColorBarColor(props.color);\r\n                }}\r\n            />\r\n            <InputBase\r\n                className={classes.legendEntryLabel}\r\n                value={props.label}\r\n                onChange={props.onChange}\r\n            />\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction LegendComponent(props) {\r\n    const classes = useStyles();\r\n    const entries = Object.keys(props.app.state.pluginData[\"Legend\"][props.app.state.activeEntry]).map((color) =>\r\n        <LegendEntry\r\n            key={color}\r\n            color={color}\r\n            label={props.app.state.pluginData[\"Legend\"][props.app.state.activeEntry][color]}\r\n            item\r\n            onChange={e => {\r\n                let currentLegendData = cloneDeep(props.app.state.pluginData[\"Legend\"]);\r\n                currentLegendData[props.app.state.activeEntry][color] = e.target.value;\r\n                props.app.updatePluginData(\"Legend\", currentLegendData);\r\n            }}\r\n            setDefaultColorBarColor={props.app.setDefaultColorBarColor}\r\n        />);\r\n    return (\r\n        <div className={classes.legendContainer}>\r\n            <Scrollbars>\r\n                <Grid container direction=\"column\" justify=\"flex-start\" wrap=\"wrap\" className={classes.legendGrid}>\r\n                    {entries}\r\n                </Grid>\r\n            </Scrollbars>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst initState = scenarioData => {\r\n    let retval = [];\r\n    let i;\r\n    for (i = 0; i < scenarioData.length; i++) {\r\n        retval.push({});\r\n    }\r\n    return retval;\r\n};\r\n\r\n// Adds color-label key value pair to pluginData entry for level of corresponding activeEntry if color was added for the first time, or delete the entry if no region has the color after the assigning\r\nfunction onAssignRegions(app, indices, color, removedColors, addedColor) {\r\n    let currentLegendData = cloneDeep(app.state.pluginData[\"Legend\"]);\r\n    if (addedColor) {\r\n        currentLegendData[app.state.activeEntry][color] = \"Label\";\r\n    }\r\n    removedColors.forEach(color => {\r\n        delete currentLegendData[app.state.activeEntry][color];\r\n    });\r\n    app.updatePluginData(\"Legend\", currentLegendData);\r\n}\r\n\r\nfunction onAddEntry(app, index) {\r\n    let currentLegendData = cloneDeep(app.state.pluginData[\"Legend\"]);\r\n    let newLegendEntry = null;\r\n    if (index > 0) { // Use new\r\n        newLegendEntry = cloneDeep(currentLegendData[index - 1]);\r\n    } else { // Use default\r\n        newLegendEntry = {};\r\n    }\r\n    currentLegendData.splice(index, 0, newLegendEntry);\r\n    app.updatePluginData(\"Legend\", currentLegendData);\r\n}\r\n\r\nfunction onDeleteEntry(app, index) {\r\n    let currentLegendData = cloneDeep(app.state.pluginData[\"Legend\"]);\r\n    currentLegendData.splice(index, 1);\r\n    app.updatePluginData(\"Legend\", currentLegendData);\r\n}\r\n\r\n// This dictionary contains the component, initial state value generation function for the plugin's entry in pluginData; this be based off the scenarioData state value\r\nconst LegendPluginDict = {\r\n    component: LegendComponent,\r\n    initState: initState, // Given the value of scenarioData (assumed to be the scenarioDataDefault), the plugin should be able to work out its initial pluginData value\r\n    // Below are functions to be called as part of App.js's corresponding methods, they expected to have this (of App) binded to them, and so code for them can be written accordingly\r\n    // The arguments they expect should be the app (as in this of the app component) + the same as the corresponding arguments in App, except for the callback TODO: this is quite a dangerous practice to give reference to top element to plugin, but it is quite useful, so going to do this for now (meaning probably not gunna change)\r\n    // For certain methods, other arguments are provided to improve performance and code reuse, check app.js for details\r\n    // The functions should not rely on the completion of the associated methods, it should only depend on the state of the app prior to running the method\r\n    // This is, except onAssignRegions, which I've set to have to run as a callback after the app's setting is complete\r\n    functions: { // Note adding more functions than ones below would require adding in the run plugin function codes in the respective method of App\r\n        onAssignRegions: onAssignRegions,\r\n        onAddEntry: onAddEntry, // Expects index argument\r\n        onDeleteEntry: onDeleteEntry, // Expects index argument\r\n        onUpdateActiveEntry: null,\r\n        onUpdateEventDate: null,\r\n        onUpdateEvent: null,\r\n        onLoadSave: null,\r\n        onProcessRegionHoveredOn: null,\r\n        onProcessRegionHoveredOut: null,\r\n    }\r\n};\r\n\r\nexport default LegendPluginDict;","import { makeStyles } from '@material-ui/core/styles';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    regionInfoContainer: {\r\n        width: \"100%\",\r\n        paddingLeft: 10,\r\n    },\r\n    regionInfoColor: {\r\n        width: 20,\r\n        height: 20,\r\n        marginLeft: 5,\r\n        marginRight: 10,\r\n        borderColor: theme.palette.text.primary,\r\n    },\r\n    regionInfoLabel: {\r\n        margin: 5,\r\n        paddingTop: 10,\r\n        paddingBottom: 10,\r\n    },\r\n}));\r\n\r\nfunction RegionInfoComponent(props) {\r\n    const classes = useStyles();\r\n    const data = props.app.state.pluginData[\"Region Info\"];\r\n    return (\r\n        <Grid container direction=\"column\" justify=\"flex-start\" alignItems=\"flex-start\" className={classes.regionInfoContainer}>\r\n            <Grid container item direction=\"row\" justify=\"flex-start\" alignItems=\"center\">\r\n                <div\r\n                    item=\"true\"\r\n                    style={{ backgroundColor: data.color ? data.color : props.app.themeDict.other.polyFillColorDefault }}\r\n                    className={classes.regionInfoColor}\r\n                />\r\n                <Typography variant=\"body2\" item=\"true\">{\"Name: \"}{data.name ? data.name : \"None\"}</Typography>\r\n            </Grid>\r\n            <Typography item=\"true\" variant=\"caption\" className={classes.regionInfoLabel}>{\"Label: \"}{data.label ? data.label : \"None\"}</Typography>\r\n        </Grid>\r\n    );\r\n}\r\n\r\nconst initState = scenarioData => {\r\n    return {\r\n        color: null,\r\n        name: null,\r\n        label: null,\r\n    };\r\n};\r\n\r\n// Sets region info to appropriate values based on hovered on layer\r\nfunction onProcessRegionHoveredOn(app, layer) {\r\n    const regionID = layer.feature.properties.regionID;\r\n    const color = app.state.scenarioData[app.state.activeEntry].regionDict[regionID].color;\r\n    const name = layer.feature.properties.name;\r\n    const label = app.state.pluginData[\"Legend\"][app.state.activeEntry][color];\r\n    let newRegionInfoData = {}\r\n    newRegionInfoData.color = color ? color : null;\r\n    newRegionInfoData.name = name ? name : null;\r\n    newRegionInfoData.label = label ? label : null;\r\n    app.updatePluginData(\"Region Info\", newRegionInfoData);\r\n}\r\n\r\n// Resets region info to default, i.e. no region selected status\r\nfunction onProcessRegionHoveredOut(app, layer) {\r\n    app.updatePluginData(\"Region Info\", {\r\n        color: null,\r\n        name: null,\r\n        label: null,\r\n    });\r\n}\r\n\r\nconst RegionInfoPluginDict = {\r\n    component: RegionInfoComponent,\r\n    initState: initState,\r\n    functions: {\r\n        onAssignRegions: null,\r\n        onAddEntry: null,\r\n        onDeleteEntry: null,\r\n        onUpdateActiveEntry: null,\r\n        onUpdateEventDate: null,\r\n        onUpdateEvent: null,\r\n        onLoadSave: null,\r\n        onProcessRegionHoveredOn: onProcessRegionHoveredOn,\r\n        onProcessRegionHoveredOut: onProcessRegionHoveredOut,\r\n    }\r\n};\r\n\r\nexport default RegionInfoPluginDict;","// Import deep cloning function\r\nimport cloneDeep from 'clone-deep';\r\n\r\n// Create a scenario entry based on the inputted regionDict, date string, event description string\r\nexport default function createScenarioEntry(regionDict, date=\"\", event=\"\") {\r\n    return {\r\n        date: date,\r\n        event: event,\r\n        regionDict: cloneDeep(regionDict), // Necessary as it appears for such complicated objects simply setting equal to regionDict would not be pass by value enough, and so you end up with entries sharing state\r\n    }\r\n}","import React from 'react';\r\nimport Dropzone from 'react-dropzone';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport createScenarioEntry from '../scripts/createScenarioEntry.js';\r\nimport cloneDeep from 'clone-deep';\r\nimport csscolors from 'css-color-names';\r\n\r\n// Adding some additional colors that I customized in the alternate history app\r\ncsscolors[\"tyrian-purple\"] = \"#66023C\";\r\ncsscolors[\"wine\"] = \"#722f37\";\r\ncsscolors[\"persian-blue\"] = \"#1C39BB\";\r\ncsscolors[\"midnight-blue\"] = csscolors[\"midnightblue\"];\r\ncsscolors[\"sky-blue\"] = csscolors[\"skyblue\"];\r\ncsscolors[\"persian-green\"] = \"#00A693\";\r\ncsscolors[\"basil\"] = \"#579229\";\r\ncsscolors[\"fire\"] = \"#e25822\";\r\ncsscolors[\"ruby\"] = \"#9B111E\";\r\n\r\n// Setup styles\r\nconst useStyles = makeStyles((theme) => ({\r\n    altHistEditorLoaderContainer: {\r\n        height: 120,\r\n        backgroundColor: theme.palette.background.paper,\r\n        width: \"100%\",\r\n        padding: 5,\r\n    },\r\n    loaderDropzone: {\r\n        textAlign: \"center\",\r\n        backgroundColor: theme.palette.background.default,\r\n        height: 120,\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\"\r\n    }\r\n\r\n}));\r\n\r\n// Class used for converting the alternate history editor save to the most recent save version in that app\r\n// This file aims to ensure back-ward compatibility of save files\r\n// Right now im doing a graduated thing of converting 1.0 to 1.1 and 1.1 to 1.2 and so on via functions for each, maybe it gets bad later but it'll be easy to refactor I assume so should be fine\r\nclass Loader { // Class which loads saves into the app, converting them regardless of version to the current version\r\n    constructor() {\r\n        this.currentSaveVersion = \"1.2\";\r\n    }\r\n\r\n    processSave(save) { // takes json parsed object file from menubar and converts it to the newest version\r\n        let version = this.detectSaveVersion(save);\r\n\r\n        if (version === \"1.0\") {\r\n            return this.processSave(this.one_zero_to_one_one(save));\r\n        } else if (version == \"1.1\") {\r\n            return this.one_one_to_one_two(save);\r\n        } else if (version == this.currentSaveVersion) { // no modification needed\r\n            return save;\r\n        }\r\n    }\r\n\r\n    one_one_to_one_two(save) { // converts 1.1 ver save to 1.2 ver save TODO: slight concerns as maybe pass by reference not value;\r\n        save.version = this.currentSaveVersion;\r\n        save.customMap = false; // 1.1 version saves didn't have non-inbuilt custom maps\r\n        save.customMapGeojson = false; // same reason as above\r\n        return save;\r\n    }\r\n\r\n    one_zero_to_one_one(save) { // converts 1.0 ver save to 1.1 ver save TODO: slight concerns as maybe pass by reference not value\r\n        save.version = \"1.1\";\r\n        let order = 0;\r\n        Object.values(save.entryDict).forEach(entry => {\r\n            // Assigns order based on current order of entryDict (which is insertion order I think if I remembered correction for such string keys)\r\n            entry[\"order\"] = order;\r\n            order++;\r\n        });\r\n        return save;\r\n    }\r\n\r\n    detectSaveVersion(save) { // detects save version from\r\n        if (\"version\" in save) { // case of versions from 1.1 onwards which has\r\n            return save.version;\r\n        } else { // case of version 1.0, as it didn't have a version attribute\r\n            return \"1.0\";\r\n        }\r\n    }\r\n}\r\n\r\n// Instance of the Loader class\r\nconst loader = new Loader();\r\n\r\n// Converts alternate history editor saves to the format appropriate for this this app\r\n// Expects a single file object, one that is compatible with JSON.stringify after processing\r\n// Returns the JSON object\r\nfunction loadScenario(app, file, onload = null) {\r\n    file.text().then(text => {\r\n        const obj = loader.processSave(JSON.parse(text));\r\n        if (obj.mapType === \"admin\") {\r\n            let convertedObj = {\r\n                scenarioData: [],\r\n                colorData: [],\r\n                pluginData: {},\r\n            };\r\n            // Generate scenarioData\r\n            Object.values(obj.entryDict).forEach(entry => {\r\n                let regionDict = cloneDeep(app.regionDictDefault);\r\n                for (const [index, color] of Object.entries(entry.mapData)) {\r\n                    if (!(index === \"undefined\")) { // We use string \"undefined\" for that seems to be what the json loading gives from the saves\r\n                        regionDict[index].color = csscolors[color];\r\n                    }\r\n                }\r\n                convertedObj.scenarioData.push(createScenarioEntry(regionDict, entry.date, entry.event));\r\n            });\r\n\r\n            // Generate colorData (due to known issues with the alternate history editor's count of colors, we shall count colors from mapData directly as opposed to using legendData in the save)\r\n            // Color string dict is here for a mapping from hex to string for later on when we wish to use refer to color tags in the save (which are in the form of a string) via hex codes in the generated colorDict\r\n            let colorStringDict = {};\r\n            Object.values(obj.entryDict).forEach(entry => {\r\n                let colorEntry = {};\r\n                for (const [index, color] of Object.entries(entry.mapData)) {\r\n                    if (!(index === \"undefined\")) { // We use string \"undefined\" for that seems to be what the json loading gives from the saves\r\n                        if (csscolors[color] in colorEntry) {\r\n                            colorEntry[csscolors[color]] += 1;\r\n                        } else {\r\n                            colorEntry[csscolors[color]] = 1;\r\n                        }\r\n\r\n                        // Update colorStringDict if the color concerned isn't in there already\r\n                        if (!(color in colorStringDict)) {\r\n                            colorStringDict[csscolors[color]] = color;\r\n                        }\r\n                    }\r\n                }\r\n                convertedObj.colorData.push(colorEntry);;\r\n            });\r\n\r\n            // Generate pluginData\r\n            // Initialise pluginData first\r\n            let pluginData = {};\r\n            for (const [name, entry] of Object.entries(app.plugins)) {\r\n                pluginData[name] = entry.initState(app.scenarioDataDefault);\r\n            };\r\n            // Modify pluginData entries (in comparison to the scenarioDataDefault case) that need to be changed according to our save, in this case at the time of writing only legend need to have its data modified\r\n            // Generate Legend data\r\n            pluginData[\"Legend\"] = [];\r\n            Object.values(obj.entryDict).forEach((entry, index) => {\r\n                // Note this index is note the same as those in obj, in obj the index starts from 1, here it starts from 0\r\n                let legendEntry = {};\r\n                for (const color of Object.keys(convertedObj.colorData[index])) {\r\n                    if (colorStringDict[color] in entry.legendData) {\r\n                        legendEntry[color] = entry.legendData[colorStringDict[color]].entry;\r\n                    } else {\r\n                        legendEntry[color] = \"None\";\r\n                    }\r\n                }\r\n                pluginData[\"Legend\"].push(legendEntry);\r\n            });\r\n            convertedObj.pluginData = pluginData;\r\n\r\n            // Load converted save\r\n            if (onload) {\r\n                onload(convertedObj);\r\n            }\r\n\r\n        } else {\r\n            console.log(\"Error: currently only supports importing admin map saves\")\r\n        }\r\n    });\r\n}\r\n\r\nfunction AltHistEditorLoaderPluginComponent(props) {\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.altHistEditorLoaderContainer}>\r\n            <Dropzone\r\n                onDrop={acceptedFiles => {\r\n                    loadScenario(props.app, acceptedFiles[0], props.app.loadSave);\r\n                }}\r\n            >\r\n                {({ getRootProps, getInputProps }) => (\r\n                    <div {...getRootProps()}>\r\n                        <input {...getInputProps()} />\r\n                        <div className={classes.loaderDropzone}>\r\n                            <div>\r\n                                Drop your save here, or click to select files\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </Dropzone>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst initState = scenarioData => {\r\n    return null;\r\n};\r\n\r\nconst AltHistEditorLoaderPluginDict = {\r\n    component: AltHistEditorLoaderPluginComponent,\r\n    initState: initState,\r\n    functions: {\r\n        onAssignRegions: null,\r\n        onAddEntry: null,\r\n        onDeleteEntry: null,\r\n        onUpdateActiveEntry: null,\r\n        onUpdateEventDate: null,\r\n        onUpdateEvent: null,\r\n        onLoadSave: null,\r\n        onProcessRegionHoveredOn: null,\r\n        onProcessRegionHoveredOut: null,\r\n    }\r\n};\r\n\r\nexport default AltHistEditorLoaderPluginDict;","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Select from '@material-ui/core/Select';\r\nimport Button from '@material-ui/core/Button';\r\n\r\n// Import scenarios\r\nimport scen356BC from \"../assets/scenario/356BC-Birth-of-Alexander.json\";\r\nimport scen1206 from \"../assets/scenario/1206-Rise-of-Mongolia.json\";\r\nimport scen1444 from \"../assets/scenario/1444-Battle-of-Varna.json\";\r\nimport scen1936 from \"../assets/scenario/1936-Coming-of-the-Storm.json\"\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\n\r\n// Import json scenarios, keys should be names that will be displayed for the scenario\r\nconst scenarios = {\r\n    \"356BC Birth of Alexander\": scen356BC,\r\n    \"1206 Rise of Mongolia\": scen1206,\r\n    \"1444 Battle of Varna\": scen1444,\r\n    \"1936 Coming of the Storm\": scen1936,\r\n};\r\n\r\n// Setup styles\r\nconst useStyles = makeStyles((theme) => ({\r\n    scenarioContainer: {\r\n        backgroundColor: theme.palette.background.paper,\r\n        width: \"calc(100% - 10px)\", // This subtraction corresponds to the padding of the parent\r\n        padding: 5,\r\n        display: \"flex\",\r\n        flexFlow: \"column\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"flex-start\",\r\n    },\r\n    scenarioSelect: {\r\n        fontSize: 12,\r\n        width: \"calc(100% - 10px)\",\r\n    }\r\n}));\r\n\r\n// Load file \r\nfunction ScenarioPluginComponent(props) {\r\n    const classes = useStyles();\r\n    const [selectedScenario, setSelectedScenario] = React.useState(Object.keys(scenarios)[0]);\r\n    return (\r\n        <div className={classes.scenarioContainer}>\r\n            <Select\r\n                value={selectedScenario}\r\n                className={classes.scenarioSelect}\r\n                onChange={e => {setSelectedScenario(e.target.value);}}\r\n            >\r\n                {Object.keys(scenarios).map(key => <MenuItem key={key} value={key}>\r\n                    {key}\r\n                </MenuItem>)}\r\n            </Select>\r\n            <Button onClick={() => {\r\n                props.app.loadSave(scenarios[selectedScenario]);\r\n            }}>Load</Button>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst initState = scenarioData => {\r\n    return null;\r\n};\r\n\r\nconst ScenarioPluginDict = {\r\n    component: ScenarioPluginComponent,\r\n    initState: initState,\r\n    functions: {\r\n        onAssignRegions: null,\r\n        onAddEntry: null,\r\n        onDeleteEntry: null,\r\n        onUpdateActiveEntry: null,\r\n        onUpdateEventDate: null,\r\n        onUpdateEvent: null,\r\n        onLoadSave: null,\r\n        onProcessRegionHoveredOn: null,\r\n        onProcessRegionHoveredOut: null,\r\n    }\r\n};\r\n\r\nexport default ScenarioPluginDict;","// This is where to import the individual plugins, i.e. this is the list of plugins you wish to add to the app toolmenu\r\n// For sake of consistency, it is recommended to save the plugin component files in src/plugins; but of course you can save it anywhere you like and import it to this js file\r\nimport LegendPlugin from './plugins/LegendPlugin.js'; // Naming the plugins with Component is not required, it could have well been just Legend, given the source plugin file is named as such, having Plugin in the name is just due to personal preferences\r\nimport RegionInfoPlugin from './plugins/RegionInfoPlugin.js';\r\nimport AltHistEditorLoaderPlugin from './plugins/AltHistEditorLoaderPlugin.js';\r\nimport ScenarioPlugin from './plugins/ScenarioPlugin.js';\r\n\r\n// All imported plugins above should then be listed below with their names, which will serve as the title in the plugins menu\r\n// Names of plugins should be unique as they will also serve as keys to the accordion element\r\n// See LegendPlugin.js for example of plugin and the requirements of it \r\n// The ordering of plugins here also determine the order of plugin display in the app\r\nconst plugins = {\r\n    \"Region Info\": RegionInfoPlugin,\r\n    \"Legend\": LegendPlugin,\r\n    \"Scenario\": ScenarioPlugin,\r\n    \"Alt Hist Editor Loader\": AltHistEditorLoaderPlugin, \r\n};\r\n\r\nexport default plugins;","import { makeStyles } from '@material-ui/core/styles';\r\nimport plugins from \"../appPlugins.js\";\r\nimport Accordion from '@material-ui/core/Accordion';\r\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\r\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Scrollbars from 'react-custom-scrollbars';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    pluginMenuContainer: {\r\n        position:\"absolute\",\r\n        right: 0,\r\n        top: \"50%\",\r\n        zIndex: 1,\r\n        minWidth: 190, // At least 200px adding in padding\r\n        width: \"12%\",\r\n        minHeight: 240, // At least 250px adding in padding\r\n        height: \"60%\",\r\n        display: \"flex\",\r\n        justifyContent: \"flex-start\",\r\n        flexFlow: \"column\",\r\n        alignItems: \"stretch\",\r\n        padding: 3,\r\n        transform: \"translate(0%, -50%)\",\r\n        borderTopStyle: \"ridge\",\r\n        borderBottomStyle: \"ridge\",\r\n        borderLeftStyle: \"ridge\",\r\n        borderColor: theme.palette.border,\r\n        backgroundImage: theme.palette.backgroundImage.main,\r\n        WebkitBorderImage: theme.palette.borderImage\r\n    },\r\n    accordionContainer: {\r\n        paddingRight: 10,\r\n        paddingLeft: 10,\r\n    },\r\n    accordionSummary: {\r\n        paddingTop: 0,\r\n        paddingBottom: 0,\r\n    },\r\n    accordionDetails: {\r\n        padding: 0,\r\n    },\r\n}));\r\n\r\nexport default function PluginMenuComponent(props) {\r\n    const classes = useStyles();\r\n    let accordionItems = [];\r\n    for (const [name, value] of Object.entries(plugins)) {\r\n        const Plugin = value.component;\r\n        accordionItems.push(\r\n            <Accordion defaultExpanded key={name} square>\r\n                <AccordionSummary expandIcon={<ExpandMoreIcon/>} className={classes.accordionSummary} IconButtonProps={{size:\"small\"}}>\r\n                    <Typography>{name}</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails className={classes.accordionDetails}>\r\n                    <Plugin app={props.app}/>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n        );\r\n    }\r\n    return (\r\n        <div className={classes.pluginMenuContainer} id=\"plugin_menu\">\r\n            <Scrollbars>\r\n                <div className={classes.accordionContainer}>\r\n                    {accordionItems}\r\n                </div>\r\n            </Scrollbars>\r\n        </div>\r\n    );\r\n}","import { makeStyles } from '@material-ui/core/styles';\r\nimport AddIcon from '@material-ui/icons/Add';\r\nimport IconButton from '@material-ui/core/IconButton';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    addIconButtonContainer: {\r\n        position: \"absolute\",\r\n        top: -12,\r\n        padding: 0,\r\n        zIndex: 1,\r\n        transform: \"scale(0.8)\"\r\n    },\r\n    addIconButton: {\r\n        padding: 0,\r\n        zIndex: 2,\r\n        color: theme.palette.text.secondary,\r\n    },\r\n}));\r\n\r\nexport default function TimelineAddButton(props) {\r\n    const classes = useStyles();\r\n    return (\r\n        <div>\r\n            <div className={classes.addIconButtonContainer} style={{left : props.themeDict.timelineMarkerSpacing/2 + 16}}>\r\n                <IconButton size=\"small\" className={classes.addIconButton} onClick={() => { props.addEntry(props.index + 1); }}>\r\n                    {/*This is the fake button for visuals only*/}\r\n                    <AddIcon></AddIcon>\r\n                </IconButton>\r\n            </div>\r\n        </div>\r\n    );\r\n}","// Import packages\r\nimport React from \"react\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport RadioButtonUncheckedIcon from '@material-ui/icons/RadioButtonUnchecked';\r\nimport RadioButtonCheckedIcon from '@material-ui/icons/RadioButtonChecked';\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport TimelineAddButton from './TimelineAddButton.js';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    timelineMarker: {\r\n        position: \"absolute\",\r\n        top: 15,\r\n        zIndex: 2,\r\n        transform: \"scale(0.8)\",\r\n    },\r\n    entryButton: {\r\n        color: theme.palette.text.primary,\r\n        padding: 0,\r\n    },\r\n    markerLabel: {\r\n        position: \"absolute\",\r\n        top: -20,\r\n        left: \"50%\",\r\n        textAlign: \"center\",\r\n        textOverflow: \"ellipsis\",\r\n        overflow: \"hidden\",\r\n        whiteSpace: \"nowrap\",\r\n        color: theme.palette.text.primary\r\n    },\r\n}));\r\n\r\nexport default function TimelineMarker(props) {\r\n    const classes = useStyles();\r\n    const icon = props.selected ? <RadioButtonCheckedIcon/> : <RadioButtonUncheckedIcon/>;\r\n    return (\r\n        <div className={classes.timelineMarker} style={{left: (props.index+1)*props.themeDict.timelineMarkerSpacing}}>\r\n            {/*props.index+1 as we wish to add after the current entry*/}\r\n            <Typography\r\n                className={classes.markerLabel}\r\n                variant=\"body2\"\r\n                style={{\r\n                    width:props.themeDict.timelineMarkerLabelWidth,\r\n                    marginLeft:-props.themeDict.timelineMarkerLabelWidth/2,\r\n                }}\r\n            >\r\n            {props.label}\r\n            </Typography>\r\n            <TimelineAddButton themeDict={props.themeDict} addEntry={props.addEntry} index={props.index}/>\r\n            <IconButton className={classes.entryButton} size=\"small\" onClick={() => {props.updateActiveEntry(props.index);}}>\r\n                {icon}\r\n            </IconButton>\r\n        </div>\r\n    );\r\n}","// Import packages\r\nimport React from \"react\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { Scrollbars } from 'react-custom-scrollbars';\r\n\r\n// Import custom components\r\nimport TimelineMarker from './TimelineMarker.js';\r\n\r\n// Import script\r\nimport useWindowSize from '../scripts/useWindowSize.js';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    timelineBarContainer: {\r\n        position: \"absolute\",\r\n        width: \"100%\",\r\n        height: 45, // If this is adjusted, need to adjust the height of the map element and event component as well so that the top of the timeline meets the bottom of the map\r\n        bottom: 0,\r\n        overflow: \"hidden\",\r\n        zIndex: 2,\r\n        borderTopStyle: \"ridge\",\r\n        borderColor: theme.palette.border,\r\n        backgroundImage: theme.palette.backgroundImage.main,\r\n        WebkitBorderImage: theme.palette.borderImage\r\n    },\r\n    timelineLine: {\r\n        position: \"absolute\",\r\n        top: 26,\r\n        left: 0,\r\n        height: 2,\r\n        backgroundColor: theme.palette.text.primary,\r\n    },\r\n    timelineBarContentContainer: {\r\n        display: \"relative\",\r\n        height: \"100%\",\r\n    },\r\n    timelineBarMarkerContainer: {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        left: 0,\r\n    }\r\n}));\r\n\r\nexport default function TimelineBarComponent(props) {\r\n    const classes = useStyles();\r\n    const markers = props.scenarioData.map((entry, index) =>\r\n        <TimelineMarker key={index} index={index} label={entry.date} selected={props.activeEntry === index} updateActiveEntry={props.updateActiveEntry} addEntry={props.addEntry} themeDict={props.themeDict} />\r\n    )\r\n    const [width, height] = useWindowSize(); // Values that change whenever window is resized, height is not used for now TODO: get rid of height part if performacne suffers, else overhead I guess is fine\r\n    const lineLength = Math.max(width, (props.scenarioData.length + 1) * props.themeDict.timelineMarkerSpacing); // Take the larger of the viewport width and the length required to fit the timeline markers as the length of the timeline TODO: the issue of what I've done here is that the right end and the left end of the timeline won't match up in length when the second line length case in the max arguments is triggered, not too important, but fix it if possible\r\n    return (\r\n        <div className={classes.timelineBarContainer} id=\"timeline_bar\">\r\n            <Scrollbars className={classes.timelineBarContentContainer}>\r\n                <div className={classes.timelineBarContentContainer}>\r\n                    <div className={classes.timelineLine} style={{ width: lineLength }}></div>\r\n                    <div className={classes.timelineBarMarkerContainer} style={{ width: lineLength }}>\r\n                        {markers}\r\n                    </div>\r\n                </div>\r\n            </Scrollbars>\r\n        </div>\r\n    );\r\n}","import React from \"react\";\r\n\r\n// Function for listener on windows resize\r\nexport default function useWindowSize() {\r\n    const [size, setSize] = React.useState([0, 0]);\r\n    React.useLayoutEffect(() => {\r\n        function updateSize() {\r\n            setSize([window.innerWidth, window.innerHeight]);\r\n        }\r\n        window.addEventListener('resize', updateSize);\r\n        updateSize();\r\n        return () => window.removeEventListener('resize', updateSize);\r\n    }, []);\r\n    return size;\r\n}","// Import React\r\nimport React from \"react\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Button from \"@material-ui/core/Button\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    eventContainer: {\r\n        position: \"absolute\",\r\n        left: 0,\r\n        bottom: 48, // This value should be such that the event box touches the timeline bar on the bottom, so adjust accordingly\r\n        minWidth: 240, // At least 250px adding in padding\r\n        width: \"15%\",\r\n        minHeight: 190, // At least 200px adding in padding\r\n        height: \"25%\",\r\n        zIndex: 1,\r\n        display: \"flex\",\r\n        flexFlow: \"column\",\r\n        alignItems: \"stretch\",\r\n        padding: 5,\r\n        borderRightStyle: \"ridge\",\r\n        borderTopStyle: \"ridge\",\r\n        borderColor: theme.palette.border,\r\n        backgroundImage: theme.palette.backgroundImage.main,\r\n        WebkitBorderImage: theme.palette.borderImage\r\n    },\r\n    eventBar: {\r\n        display: \"flex\",\r\n        height: 50,\r\n        flexFlow: \"row\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"space-between\",\r\n        backgroundImage: theme.palette.backgroundImage.main\r\n    },\r\n    eventContent: {\r\n        marginTop: 5,\r\n        flexGrow: 1,\r\n        resize: \"none\",\r\n        backgroundColor: theme.palette.background.paper,\r\n        color: theme.palette.text.primary,\r\n    },\r\n    eventButton: {\r\n        fontSize: 10,\r\n        margin: 2,\r\n    },\r\n    dateInput: {\r\n        margin: 10,\r\n    }\r\n}));\r\n\r\nexport default function TimelineEventComponent(props) {\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.eventContainer} id=\"timeline_event\">\r\n            <div className={classes.eventBar}>\r\n                <TextField size=\"small\" label=\"Date\" margin=\"dense\" value={props.date} onChange={e => {props.updateEventDate(e.target.value)}} className={classes.dateInput}></TextField>\r\n                <Button variant=\"contained\" size=\"large\" color=\"primary\" onClick={() => {props.clearEntry();}} className={classes.eventButton}>Clear</Button>\r\n                <Button variant=\"contained\" size=\"large\" color=\"secondary\" onClick={() => {props.deleteEntry(props.activeEntry);}} disabled={props.oneEntryLeft} className={classes.eventButton}>Delete</Button>\r\n                {/*Delete button is disabled for the first entry TODO: because for now we haven't implemented the add entry before first element functionality yet, nor is there a button for it*/}\r\n            </div>\r\n            <textarea className={classes.eventContent} value={props.event} onChange={e => {props.updateEvent(e.target.value)}} multiline=\"true\"></textarea>\r\n        </div>\r\n    );\r\n}","export default __webpack_public_path__ + \"static/media/MarbleTexture.7859fdc3.jpg\";","export default __webpack_public_path__ + \"static/media/GoldTexture.302ee534.png\";","import MarbleTexture from '../assets/img/MarbleTexture.jpg';\r\nimport GoldTexture from '../assets/img/GoldTexture.png';\r\n\r\n// Colors should be given in hex\r\nconst themeDict = {\r\n    material: { // Theme object for material ui theming component FIXME: add corresponding use themeprovider thing to the app js\r\n        palette: {\r\n            type: \"dark\",\r\n            secondary: {\r\n                main: \"#d50000\",\r\n                light: \"#ff5131\",\r\n                dark: \"#9b0000\"\r\n            },\r\n            border: \"#d4af37\",\r\n            borderImage: `url(${GoldTexture}) 30`,\r\n            backgroundImage: {\r\n                main: `url(${MarbleTexture})`,\r\n            }\r\n        },\r\n    },\r\n    other: { // Theme object for map (currently done via cesium) to use, this is passed down as props to all child\r\n        polyStrokeColor: \"#36454F\",\r\n        polyStrokeWeight: 0.5,\r\n        polyFillColorDefault: \"#DCDCDC\",\r\n        polyFillOpacityDefault: 0.2,\r\n        polyFillOpacityColored: 0.6,\r\n        polyFillOpacityHovered: 0.9,\r\n        timelineMarkerSpacing: 120,\r\n        timelineMarkerLabelWidth: 100,\r\n    }\r\n\r\n}\r\n\r\nexport default themeDict;","// Import React and other modules\r\nimport React from \"react\";\r\nimport { createMuiTheme, ThemeProvider, withStyles } from '@material-ui/core/styles';\r\nimport Backdrop from '@material-ui/core/Backdrop';\r\n\r\n// Import css\r\nimport './App.css';\r\n\r\n// Import custom components\r\nimport HelpComponent from \"./components/HelpComponent\";\r\nimport MenuComponent from \"./components/MenuComponent.js\";\r\nimport MapComponent from './components/MapComponent.js';\r\nimport ColorBarComponent from './components/ColorBarComponent.js';\r\nimport ToolbarComponent from \"./components/ToolbarComponent.js\";\r\nimport PluginMenuComponent from \"./components/PluginMenuComponent.js\";\r\nimport TimelineBarComponent from './components/TimelineBarComponent.js';\r\nimport TimelineEventComponent from './components/TimelineEventComponent.js';\r\n\r\n// Import default themeDict\r\nimport themeDict from './themes/default';\r\n\r\n// Import default basemap geojson\r\nimport mapAdmin from \"./assets/basemap/mapAdmin.json\";\r\n\r\n// Import scripts\r\nimport createRegionDict from './scripts/createRegionDict.js';\r\nimport createScenarioEntry from './scripts/createScenarioEntry.js';\r\nimport createRegionNameDict from './scripts/createRegionNameDict.js';\r\nimport saveScenario from './scripts/saveScenario.js';\r\n\r\n// Import plugins\r\nimport plugins from \"./appPlugins.js\";\r\n\r\n// Import deep clone\r\nimport cloneDeep from \"clone-deep\";\r\n\r\n// Import Google Analytics\r\nimport ReactGA from 'react-ga';\r\n\r\n// Setup Google Analytics\r\nReactGA.initialize(\"UA-176706567-4\");\r\nReactGA.pageview(window.location.pathname + window.location.search);\r\n\r\n// Convert mapAdmin to a prototype, const dictionary indexed by regionID\r\nconst regionDictDefault = createRegionDict(mapAdmin);\r\n\r\n// Create a constant dictionary mapping index of region to name of region, as opposed to keeping this repeated info contained in every single entry in the scenario data\r\nconst regionNameDict = createRegionNameDict(mapAdmin);\r\n\r\n// Default scenarioData value\r\nconst scenarioDataDefault = [\r\n  createScenarioEntry(regionDictDefault, \"2000 January 1\", \"An Event\"), // Default is 2 entry with the default regionDict, empty date and event entry\r\n  createScenarioEntry(regionDictDefault, \"2010 January 1\", \"Another Event\"),\r\n];\r\n\r\nconst theme = createMuiTheme(themeDict.material);\r\n\r\nconst useStyles = theme => ({\r\n  backdrop: {\r\n    zIndex: 3,\r\n    color: '#fff',\r\n  },\r\n});\r\n\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.plugins = plugins;\r\n    // Default values should ideally all be based off the scenarioDataDefault\r\n    // Setup default state values\r\n    let pluginData = {};\r\n    for (const [name, entry] of Object.entries(this.plugins)) {\r\n      pluginData[name] = entry.initState(scenarioDataDefault);\r\n    }\r\n\r\n    let colorData = [];\r\n    let i;\r\n    for (i = 0; i < scenarioDataDefault.length; i++) {\r\n      colorData.push({});\r\n    }\r\n\r\n    // Set initial state\r\n    this.state = {\r\n      scenarioData: scenarioDataDefault, // Array of information for the scenarios\r\n      pluginData: pluginData, // Create object for data in plugin indexed by name of plugin\r\n      colorData: colorData, // Dictionary with corresponding entries to scenarioData, that records the number of regions of specific color for the scenario timeline entry\r\n      activeEntry: 0, // index of currently active on map entry in scenarioData\r\n      lassoSelecting: false, // state for whether lasso select tool is activated\r\n      erasing: false, // state for whether eraser tool is activated\r\n      helpOn: true, // On opening app, defaults to have help on\r\n    };\r\n\r\n    // Declare some constant attributes\r\n    this.regionNameDict = regionNameDict;\r\n    this.themeDict = themeDict;\r\n\r\n    // Some attributes for plugins to use\r\n    this.scenarioDataDefault = scenarioDataDefault;\r\n    this.regionDictDefault = regionDictDefault;\r\n\r\n    // Numerous refs\r\n    this.colorBarRef = React.createRef(null);\r\n    this.mapRef = React.createRef(null);\r\n\r\n    // Bind this to methods\r\n    this.getColor = this.getColor.bind(this);\r\n    this.assignRegions = this.assignRegions.bind(this);\r\n    this.updateActiveEntry = this.updateActiveEntry.bind(this);\r\n    this.addEntry = this.addEntry.bind(this);\r\n    this.updateEventDate = this.updateEventDate.bind(this);\r\n    this.updateEvent = this.updateEvent.bind(this);\r\n    this.deleteEntry = this.deleteEntry.bind(this);\r\n    this.updatePluginData = this.updatePluginData.bind(this);\r\n    this.clearEntry = this.clearEntry.bind(this);\r\n    this.loadSave = this.loadSave.bind(this);\r\n    this.updateLassoSelecting = this.updateLassoSelecting.bind(this);\r\n    this.updateErasing = this.updateErasing.bind(this);\r\n    this.setDefaultColorBarColor = this.setDefaultColorBarColor.bind(this);\r\n    this.processRegionHoveredOn = this.processRegionHoveredOn.bind(this);\r\n    this.processRegionHoveredOut = this.processRegionHoveredOut.bind(this);\r\n    this.save = this.save.bind(this);\r\n    this.closeHelp = this.closeHelp.bind(this);\r\n    this.openHelp = this.openHelp.bind(this);\r\n  }\r\n\r\n  openHelp() {\r\n    this.setState({helpOn:true});\r\n  }\r\n\r\n  closeHelp() {\r\n    this.setState({helpOn:false});\r\n  }\r\n\r\n  processRegionHoveredOn(layer) {\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onProcessRegionHoveredOn) {\r\n        entry.functions.onProcessRegionHoveredOn(this, layer);\r\n      }\r\n    });\r\n  }\r\n\r\n  processRegionHoveredOut(layer) {\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onProcessRegionHoveredOut) {\r\n        entry.functions.onProcessRegionHoveredOut(this, layer);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Updates plugin data for the specified plugin with the specified data, the key should be the one used in the plugins dictionary\r\n  updatePluginData(key, data) {\r\n    let currentData = cloneDeep(this.state.pluginData);\r\n    currentData[key] = data;\r\n    this.setState({ pluginData: currentData });\r\n  }\r\n\r\n  // Updates lasso selecting, expects true/false boolean value, then runs callback if any\r\n  updateLassoSelecting(newState, callback = null) {\r\n    this.setState({ lassoSelecting: newState }, () => {\r\n      if (callback) {\r\n        callback();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Update eraser state, such state in turn determins the value getColor returns\r\n  updateErasing(newState) {\r\n    this.setState({ erasing: newState });\r\n  }\r\n\r\n  // Returns hex of currently selected color, as in the colorBarComponent\r\n  getColor() {\r\n    return this.state.erasing ? null : this.colorBarRef.current.state.color;\r\n  }\r\n\r\n  // Sets color in colorBarComponent, expects a hex string\r\n  setDefaultColorBarColor(color) {\r\n    this.colorBarRef.current.setState({ color: color });\r\n  }\r\n\r\n  // Adds entry in position at specified index in scenarioData and colorData, new entry has no date nor event\r\n  addEntry(index) {\r\n    let currentData = cloneDeep(this.state.scenarioData);\r\n    let currentColorData = cloneDeep(this.state.colorData);\r\n    let newRegionDict = null;\r\n    let newColorEntry = null;\r\n    if (index > 0) { // use the regionDict, color entry of the previous entry as the starting spot\r\n      newRegionDict = createScenarioEntry(currentData[index - 1].regionDict);\r\n      newColorEntry = cloneDeep(currentColorData[index - 1]);\r\n    } else { // use the default regionDict, color entry if we are to insert at the beginning, currently this is not possible as it seems to lead to a multi-rerender yet some code is not ran in app.render scenario, and I get a regionDict undefined thing which I have no idea why; in light of this, I didn't do the add entry button in front of the first entry\r\n      newRegionDict = createScenarioEntry(regionDictDefault);\r\n      newColorEntry = {};\r\n    }\r\n    currentData.splice(index, 0, newRegionDict);\r\n    currentColorData.splice(index, 0, newColorEntry);\r\n    this.setState({ scenarioData: currentData, colorData: currentColorData }, () => { this.updateActiveEntry(index); });\r\n\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onAddEntry) {\r\n        entry.functions.onAddEntry(this, index);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Deletes entry in position at specified index in scenarioData and colorData\r\n  deleteEntry(index) {\r\n    let currentData = cloneDeep(this.state.scenarioData);\r\n    let currentColorData = cloneDeep(this.state.colorData);\r\n    currentData.splice(index, 1);\r\n    currentColorData.splice(index, 1);\r\n    if (index === this.state.scenarioData.length - 1) {\r\n      // Deleted entry is last entry, hence new entry to be focused on is the entry before the last entry\r\n      let newIndex = index - 1;\r\n      // To avoid possibly access invalid active entry values, we update the activeEntry first, then update the scenarioDict to delete the entry\r\n      this.updateActiveEntry(newIndex, () => { this.setState({ scenarioData: currentData, colorData: currentColorData }); }) // Note reset style is included in the updateActiveEntry function already\r\n    } else {\r\n      // Deleted entry was not the last entry, hence new entry to be focused on is the entry after the deleted entry, i.e. activeEntry index need not change\r\n      this.setState({ scenarioData: currentData, colorData: currentColorData }, () => { this.mapRef.current.resetAllRegionStyle(); });\r\n    }\r\n\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onDeleteEntry) {\r\n        entry.functions.onDeleteEntry(this, index);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Updates event date for active entry, expects a string argument\r\n  updateEventDate(date) {\r\n    let currentData = cloneDeep(this.state.scenarioData);\r\n    currentData[this.state.activeEntry].date = date;\r\n    this.setState({ scenarioData: currentData });\r\n\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onUpdateEventDate) {\r\n        entry.functions.onUpdateEventDate(this, date);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Updates event description for active entry, expects a string argument\r\n  updateEvent(event) {\r\n    let currentData = cloneDeep(this.state.scenarioData);\r\n    currentData[this.state.activeEntry].event = event;\r\n    this.setState({ scenarioData: currentData });\r\n\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onUpdateEvent) {\r\n        entry.functions.onUpdateEvent(this, event);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Clears date and event of the current active entry, not the map though\r\n  clearEntry() {\r\n    let currentData = cloneDeep(this.state.scenarioData);\r\n    currentData[this.state.activeEntry].event = \"\";\r\n    currentData[this.state.activeEntry].date = \"\";\r\n    this.setState({ scenarioData: currentData });\r\n  }\r\n\r\n  // Updates index for active entry\r\n  updateActiveEntry(newIndex, callback = null) {\r\n    this.setState(\r\n      { activeEntry: newIndex },\r\n      () => {\r\n        this.mapRef.current.resetAllRegionStyle();\r\n        if (callback) { // runs callback if callback is not null\r\n          callback();\r\n        }\r\n      });\r\n\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onUpdateActiveEntry) {\r\n        entry.functions.onUpdateActiveEntry(this, newIndex);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Assigns regions of specified indices the currently selected color and update colorData accordingly, then run callback if any\r\n  assignRegions(indices, callback = null) {\r\n    const color = this.getColor();\r\n\r\n    // Modifying the new data before setting it as the state\r\n    let currentData = cloneDeep(this.state.scenarioData);\r\n    let currentColorData = cloneDeep(this.state.colorData);\r\n    let removedColors = [];\r\n    let addedColor = false;\r\n\r\n    indices.forEach(index => {\r\n      const previousColor = currentData[this.state.activeEntry].regionDict[index].color;\r\n      // Update for scenarioData the color of the region\r\n      currentData[this.state.activeEntry].regionDict[index].color = color;\r\n\r\n      // Only need to update if the previousColor is different from current color\r\n      if (previousColor !== color) {\r\n        // Deal with decrementing previous color's colorData entry, if any\r\n        if (previousColor) {\r\n          currentColorData[this.state.activeEntry][previousColor] -= 1;\r\n          if (currentColorData[this.state.activeEntry][previousColor] === 0) {\r\n            // If the assigning took the count of regions of the color to 0, then remove it from the colorData\r\n            delete currentColorData[this.state.activeEntry][previousColor];\r\n            removedColors.push(previousColor);\r\n          }\r\n        }\r\n\r\n        // Deal with incrementing or creating entry for added color's colorData entry, if any\r\n        if (color) {\r\n          if (color in currentColorData[this.state.activeEntry]) {\r\n            currentColorData[this.state.activeEntry][color] += 1;\r\n          } else {\r\n            currentColorData[this.state.activeEntry][color] = 1;\r\n            addedColor = true;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // Setting state, then do callback\r\n    this.setState({ scenarioData: currentData, colorData: currentColorData },\r\n      () => {\r\n        this.mapRef.current.resetAllRegionStyle();\r\n        if (callback) {\r\n          callback();\r\n        }\r\n\r\n        // Running plugin methods\r\n        Object.values(this.plugins).forEach(entry => {\r\n          if (entry.functions.onAssignRegions) {\r\n            entry.functions.onAssignRegions(this, indices, color, removedColors, addedColor);\r\n          }\r\n        });\r\n      });\r\n  }\r\n\r\n  // Saves the currently loaded scenario\r\n  save() {\r\n    saveScenario({\r\n      scenarioData: this.state.scenarioData,\r\n      colorData: this.state.colorData,\r\n      pluginData: this.state.pluginData,\r\n    });\r\n  }\r\n\r\n  // Loads the specified save file containing scenarioData and pluginData, then sets current active entry to the first one, thereby resetting the region styling as well\r\n  loadSave(saveData) {\r\n    this.setState({ scenarioData: saveData.scenarioData, colorData: saveData.colorData, pluginData: saveData.pluginData }, () => { this.updateActiveEntry(0) });\r\n\r\n    // Running plugin methods\r\n    Object.values(this.plugins).forEach(entry => {\r\n      if (entry.functions.onLoadSave) {\r\n        entry.functions.onLoadSave(this, saveData);\r\n      }\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { classes } = this.props;\r\n    return (\r\n      <ThemeProvider theme={theme}>\r\n        <div className=\"App\">\r\n          <Backdrop className={classes.backdrop} open={this.state.helpOn} onClick={this.closeHelp}>\r\n            <HelpComponent/>\r\n          </Backdrop>\r\n          <MenuComponent\r\n            save={this.save}\r\n            loadSave={this.loadSave}\r\n            openHelp={this.openHelp}\r\n          />\r\n          <ToolbarComponent lassoSelecting={this.state.lassoSelecting} updateLassoSelecting={this.updateLassoSelecting} erasing={this.state.erasing} updateErasing={this.updateErasing} />\r\n          <PluginMenuComponent app={this} />\r\n          <TimelineBarComponent\r\n            updateActiveEntry={this.updateActiveEntry}\r\n            activeEntry={this.state.activeEntry}\r\n            scenarioData={this.state.scenarioData}\r\n            addEntry={this.addEntry}\r\n            themeDict={this.themeDict.other}\r\n          />\r\n          <TimelineEventComponent\r\n            date={this.state.scenarioData[this.state.activeEntry].date}\r\n            event={this.state.scenarioData[this.state.activeEntry].event}\r\n            updateEventDate={this.updateEventDate}\r\n            updateEvent={this.updateEvent}\r\n            deleteEntry={this.deleteEntry}\r\n            activeEntry={this.state.activeEntry}\r\n            clearEntry={this.clearEntry}\r\n            oneEntryLeft={this.state.scenarioData.length === 1}\r\n            themeDict={this.themeDict.other}\r\n          />\r\n          <ColorBarComponent defaultColorBarColor={this.state.defaultColorBarColor} ref={this.colorBarRef} themeDict={this.themeDict.other} />\r\n          <MapComponent\r\n            themeDict={this.themeDict.other}\r\n            baseMap={mapAdmin}\r\n            assignRegions={this.assignRegions}\r\n            regionDict={this.state.scenarioData[this.state.activeEntry].regionDict}\r\n            lassoSelecting={this.state.lassoSelecting}\r\n            updateLassoSelecting={this.updateLassoSelecting}\r\n            processRegionHoveredOn={this.processRegionHoveredOn}\r\n            processRegionHoveredOut={this.processRegionHoveredOut}\r\n            ref={this.mapRef}\r\n          />\r\n        </div>\r\n      </ThemeProvider>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withStyles(useStyles)(App);","// Given geoJson with features (here assume regions, i.e. polygons/multipolygons) each with properties regionID and color and label\r\n// Generate a js object with keys as the regionID and value as object of the properties of the regions\r\nexport default function createRegionDict(geoJson) {\r\n    let retval = {};\r\n    geoJson.features.forEach(region => {\r\n        retval[region.properties.regionID] = { // TODO: get rid of object, change code elsewhre as well so it only has the value color, no need to object\r\n            color: null, // expects a hex string, or if null takes the default fill color as specified in theme\r\n        };\r\n    });\r\n    return retval;\r\n}","// Given geoJson with features (here assume regions, i.e. polygons/multipolygons) each with properties regionID and name\r\n// Generate a js object with keys as the regionID and value as object of the properties of the regions\r\nexport default function createRegionNameDict(geoJson) {\r\n    let retval = {};\r\n    geoJson.features.forEach(region => {\r\n        retval[region.properties.regionID] = region.properties.name;\r\n    });\r\n    return retval;\r\n}","import { saveAs } from 'file-saver';\r\n\r\n// Expects an generic javascript object, one that is compatible with JSON.stringify and reading\r\nexport default function saveScenario(obj) {\r\n    const blob = new Blob([JSON.stringify(obj)], {type: \"application/json;charset=utf-8\"});\r\n    saveAs(blob, \"save.json\");\r\n};","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <App />,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}